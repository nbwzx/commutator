/*!
 * Commutator (https://github.com/nbwzx/commutator)
 * Copyright (c) 2022 Zixing Wang <zixingwang.cn@gmail.com>
 * Licensed under MIT (https://github.com/nbwzx/commutator/blob/main/LICENSE)
 */
var commutator=function(){function r(r){var a=r;a=a.replace(/[\u00ad\u1806\u034f\u180b-\u180d\ufe0f-\uff00\ufffc]+/gu,""),a=a.replace(/[\u0009\u000a\u000b\u000c\u000d\u0085]/gu," "),a=a.replace(/[\u0000-\u0008\u000e-\u001f\u007f-\u0084\u0086-\u009f\u06dd\u070f\u180e\u200c-\u200f\u202a-\u202e\u2060-\u2063\u206a-\u206f\ufeff\ufff9-\ufffb]+/gu,""),a=a.replace(/\u200b/gu,""),a=a.replace(/[\u00a0\u1680\u2000-\u200a\u2028-\u2029\u202f\u205f\u3000]/gu," "),a=a.replace(/[\u061c\u115f\u1160\u17b4\u17b5\u2064\u2800\u3164\uffa0]/gu," "),a=a.replace(/[!ï¼]/gu," "),a=a.replace(/\s+/gu," "),a=a.trim();var e={"'":"ï½€Î„ï¼‡ËˆËŠá‘ŠË‹êŒá›Œâ€˜â€™Õšâ€›Õ`â€²×³Â´Ê¹Ë´ß´â€µßµÊ»Ê¼á¾½Ê½á¿¾Ê¾á¾¿Ê¿",",":"Â¸ê“¹â€šØÙ«ï¼Œ","/":"â„â³†âŸ‹ãƒâ•±ã€³âˆ•â§¸",":":"ï¸°âˆ¶:á›¬âšÜƒï¼šê“½×ƒÖ‰Ëê‰Ü„Ë¸;","(":"ï¼ˆ{",")":"ï¼‰}","[":"ã€","]":"ã€‘","+":"ğŠ›+á›­","*":"Ã—"};for(var t in e)for(var n=e[t],u=0;u<n.length;u++){var o=n[u];a=a.replace(o,t)}return a}function a(a){var e,n,c,l;K=null!==(e=a.order)&&void 0!==e?e:y,or=null!==(n=a.initialReplace)&&void 0!==n?n:H,cr=null!==(c=a.finalReplace)&&void 0!==c?c:I,ur=null!==(l=a.commute)&&void 0!==l?l:G;var i=r(a.algorithm);i=i.replace(/\*\s/gu,"*").replace(/\s\*/gu,"*").replace(/:\s/gu,":").replace(/\s:/gu,":").replace(/\[\s/gu,"[").replace(/\s\[/gu,"[").replace(/\]\s/gu,"]").replace(/\s\]/gu,"]").replace(/,\s/gu,",").replace(/\s,/gu,",").replace(/\+\s/gu,"+").replace(/\s\+/gu,"+").replace(/\*2/gu,"2");for(var f=i.length-1;f>1;f--)if("2"===i[f]&&")"===i[f-1]){for(var s=f-1;"("!==i[s]&&s>=0;)s--;if(s>=0){i=i.slice(0,s)+i.slice(s+1,f-1)+i.slice(s+1,f-1)+i.slice(f+1);break}}for(f=i.length-1;f>1;f--)if("2"===i[f]&&"]"===i[f-1]){for(s=f-1;"["!==i[s]&&s>=0;)s--;if(s>=0){i=i.slice(0,s)+i.slice(s+1,f-1)+i.slice(s+1,f-1)+i.slice(f+1);break}}i=i.replace(/\(/gu,""),i=i.replace(/\)/gu,""),i="[".concat(i.replace(/\+/gu,"]+["),"]"),i=i.replace(/\]\[/gu,"]+["),0===K?(W=!0,K=N):W=!1,Q=Math.floor(K/2)+1-K,T=Math.floor(K/2);var p=u(t(i));if("Lack left parenthesis."===p[0]||"Lack right parenthesis."===p[0])return p[0];var h=o(p);if(""===h)return"";var g=U(v(h));return""===g?"":g}function e(r){var a="+:,/[]";return a.indexOf(r)>-1}function t(r){for(var a=[r[0]],t=1;t<r.length;t++)e(r[t])||e(a.slice(-1)[0])?a.push(r[t]):a.push(a.pop()+r[t]);return a}function n(r){return":"===r?0:","===r?1:"/"===r?2:"+"===r?3:"["===r?4:"]"===r?5:-1}function u(r){for(var a=[],t=[],u=!1,o="";r.length>0;){var c=r.shift();if(e(c))if("]"===c){for(u=!1;t.length>0;){if(o=t.pop(),"["===o){u=!0;break}a.push(o)}if(!u)return["Lack left parenthesis."]}else{for(;t.length>0&&"["!==t.slice(-1)[0]&&n(c)<=n(t.slice(-1)[0]);)a.push(t.pop());t.push(c)}else a.push(c)}for(;t.length>0;){if(o=t.pop(),"["===o)return["Lack right parenthesis."];a.push(o)}return a}function o(r){for(var a,t=[];r.length>0;){var n=r.shift();if(e(n)){if(!(t.length>=2))return"";var u=t.pop(),o=t.pop();t.push(c(o,u,n))}else t.push(n)}return null!==(a=t[0])&&void 0!==a?a:""}function c(r,a,e){var t=[],n=[];switch(t=v(r),n=v(a),e){case"+":return U(t.concat(n));case":":return U(t.concat(n,E(t)));case",":return U(t.concat(n,E(t),E(n)));case"/":return U(t.concat(n,E(t),E(t),E(n),t));default:return U(t.concat(n))}}function l(r){var a=r;a="[".concat(a.replace(/\+/gu,"]+["),"]"),a=a.replace(/\]\[/gu,"]+[");for(var n=u(t(a)),o=[];n.length>0;){var c=n.shift();if(e(c)){var l=o.pop(),f=o.pop(),s=Number(f),p=Number(l);isNaN(s)&&(s=f.split(" ").length),isNaN(p)&&(p=l.split(" ").length),o.push(i(s,p,c).toString())}else o.push(c)}return Number(o[0])}function i(r,a,e){switch(e){case"+":return r+a+$;case":":return r+a;case",":return Y*Math.max(r,a)+Z*Math.min(r,a);default:return 1/0}}function f(r,a){return l(r)-l(a)}function s(r){var e,t,n,u,o,c,l,i,s,h,g,b,m,M,E,U,R=r.algorithm;K=null!==(e=r.order)&&void 0!==e?e:y,X=null!==(t=r.outerBracket)&&void 0!==t?t:k,Y=null!==(n=r.abMaxScore)&&void 0!==n?n:B,Z=null!==(u=r.abMinScore)&&void 0!==u?u:D,$=null!==(o=r.addScore)&&void 0!==o?o:x,or=null!==(c=r.initialReplace)&&void 0!==c?c:H,cr=null!==(l=r.finalReplace)&&void 0!==l?l:I,ur=null!==(i=r.commute)&&void 0!==i?i:G,_=null!==(s=r.fast)&&void 0!==s?s:A,rr=null!==(h=r.slashNotation)&&void 0!==h?h:C,ar=null!==(g=r.noBrackets)&&void 0!==g?g:j,er=null!==(b=r.spaceAfterColon)&&void 0!==b?b:P,tr=null!==(m=r.spaceAfterComma)&&void 0!==m?m:q,nr=null!==(M=r.outerBrackets)&&void 0!==M?M:z;var L=null!==(E=r.maxDepth)&&void 0!==E?E:F,N=null!==(U=r.limit)&&void 0!==U?U:O;if(J=[],""===R)return[""];var lr=a({algorithm:R,order:K,initialReplace:or,finalReplace:cr,commute:ur});if("Lack left parenthesis."===lr||"Lack right parenthesis."===lr||""===lr)return[lr];var ir=v(lr);0===K||W?(W=!0,K=2*(V+2)):W=!1,Q=Math.floor(K/2)+1-K,T=Math.floor(K/2);for(var fr=ir.length,sr=0;sr<fr;sr++){for(var pr=0,hr=0;hr<fr;hr++)ir[sr].base===ir[hr].base&&(pr+=ir[hr].amount);if(pr%K!=0)return["Not found."]}var vr=0,gr=[];for(sr=0;sr<fr-1;sr++)w(ir[sr],ir[sr+1])&&(gr[vr]=sr,vr+=1);var dr=Math.pow(2,vr),br=["Not found."],mr=!1,Mr=0;Mr=0===L?Math.floor((fr-1)/3):L;for(var Er=1;Er<=Mr;Er++){for(sr=0;sr<dr;sr++){var Ur=ir.concat();for(hr=0;hr<vr;hr++)0!=(sr&1<<hr)&&(Ur=S(Ur,gr[hr],gr[hr]+1));if(br=d(Ur,Er,Er),"Not found."!==br[0]&&(mr=!0),_&&mr)return J}if(mr&&(Er===L||0===L))return J.sort(f),J=J.map(function(r){return p(r,rr,ar,er,tr,nr)}),0===N?J:J.slice(0,N)}return["Not found."]}function p(r,a,e,t,n,u){var o=r;return o.includes(".")?o:(a&&(o=h(o)),e&&(o=o.replace("[","").replace("]","")),t&&(o=o.replace(":",": ")),n&&(o=o.replace(",",", ")),u&&"["!==o[0]&&(o="[".concat(o,"]")),o)}function h(r){if(!r.includes("["))return r;var a="";r.includes(":")&&(a=r.split(":")[0]);var e=r.split("[")[1].split(",")[0],t=r.split(",")[1].split("]")[0],n=R(v(a)),u=R(v(t));if(""===e||""===t)return"";if(""===a)return"[".concat(e,",").concat(t,"]");if(1===u.length)for(var o=0,c=[-2,2];o<c.length;o++){var l=c[o];if((u[0].amount+l)%K==0){var i=[{base:u[0].base,amount:-l/2}],f=R(n.concat(i)),s=U(f),p=U(E(i));if(f.length<n.length)return""===s?"[".concat(p,"/").concat(e,"]"):"".concat(s,":[").concat(p,"/").concat(e,"]")}}return r}function v(a){var e=r(a);for(var t in or){var n=new RegExp(t,"gu");e=e.replace(n,or[t])}if(e=e.replace(/\s+/giu,""),""===e)return[];for(var u="",o=0;o<e.length;o++)(e[o+1]<"0"||e[o+1]>"9")&&"'"!==e[o+1]?u="".concat(u+e[o]," "):u+=e[o];var c=u.split(" "),l=[];for(o=0;o<c.length;o++){l[o]={base:c[o][0],amount:0};var i=c[o].replace(/[^0-9]/gu,"");l[o].amount=""===i?1:Number(i),l[o].amount>V&&(V=l[o].amount),c[o].indexOf("'")>-1&&(l[o].amount=-l[o].amount)}return l}function g(r,a,e){for(var t=0,n=[],u=0;u<r.length-1;u++)w(r[u],r[u+1])&&(n[t]=u,t+=1);var o=Math.pow(2,t),c=["Not found."];for(u=0;u<o;u++){for(var l=r.concat(),i=0;i<t;i++)0!=(u&1<<i)&&(l=S(l,n[i],n[i]+1));if(c=d(l,a,e),"Not found."!==c[0])return c}return["Not found."]}function d(r,a,e){var t=R(r),n="",u=t.concat(),o=t.length;if(t.length<3*a+1)return["Not found."];for(var c=0;c<=(o+t.length+1)/2-1;c++)for(var i=1;i<K;i++){var f=(i%2*2-1)*Math.floor((i+1)/2);if(0===c){if(i>1)break}else{if(Math.abs(f)>Math.abs(u[c-1].amount))break;if((K%2==1||u[c-1].amount!==Math.floor(K/2))&&(u[c-1].amount<0&&f>0||u[c-1].amount>0&&f<0))continue}t=M(u,c,f);for(var s=1;s<=t.length/2-1;s++){var p=0;p=1===a?Math.max(1,Math.floor((t.length+1)/2-s)):1;for(var h=p;h<=t.length/2-1;h++){var v=[],d=[],S=[[]],N=[[]];if(t[s-1].base===t[s+h-1].base){for(var y=Q;y<=T;y++)if(0!==y){var k=L(t[s+h-1].amount+y);v=R(b(t.slice(0,s),y)),S.push(v),d=R(E(v).concat(b(t.slice(0,s+h),k))),N.push(d)}}else{if(1===a&&t[s].base!==t[t.length-1].base)continue;v=R(t.slice(0,s)),S.push(v),d=R(t.slice(s,s+h)),N.push(d);var B=[];w(t[s-1],t[s+h-1])&&(S.push(v),B=R(d.concat([t[s-1]])),N.push(B),s>=2&&w(t[s-1],t[s-2])&&(S.push(v),B=R(d.concat(t.slice(s-2,s))),N.push(B))),w(t[s],t[s+h])&&(B=R(v.concat(E([t[s+h]]))),S.push(B),B=R([t[s+h]].concat(d)),N.push(B),t.length>=s+h+2&&w(t[s+h],t[s+h+1])&&(B=R(v.concat(E(t.slice(s+h,s+h+2)))),S.push(B),B=R(t.slice(s+h,s+h+2).concat(d)),N.push(B)))}for(var D=1;D<S.length;D++){v=S[D],d=N[D];var x=R(d.concat(v,E(d),E(v),t)),F="";if(a>1)F=g(x,a-1,e)[0];else if(x.length>0)continue;if("Not found."!==F){var O=v,A=d,C=R(d.concat(v));C.length<Math.max(v.length,d.length)&&(v.length<=d.length?(O=v,A=C):(O=E(d),A=C));var j=R(b(u.slice(0,c),f)),P=O,q=A;if(j.length>0&&1===e){var z=R(j.concat(A));z.length<j.length-1&&(j=z,P=E(A),q=O)}var G=U(P),H=U(q),I=U(j);if(""===G||""===H)continue;var V=m(I,G,H,F);if(""===n&&(n=V),l(V)<l(n)&&(n=V),a===e&&-1===J.indexOf(V)&&J.push(V),_)return[n]}}}}}return""===n?["Not found."]:[n]}function b(r,a){var e=r.concat();if(0===e.length)return[];var t=e.pop();return 0===a?e:(e.push({base:t.base,amount:a}),e)}function m(r,a,e,t){return""===t?X?""===r?"[".concat(a,",").concat(e,"]"):"[".concat(r,":[").concat(a,",").concat(e,"]]"):""===r?"[".concat(a,",").concat(e,"]"):"".concat(r,":[").concat(a,",").concat(e,"]"):X?""===r?"[".concat(a,",").concat(e,"]").concat(t):"[".concat(r,":[").concat(a,",").concat(e,"]").concat(t,"]"):""===r?"[".concat(a,",").concat(e,"]+").concat(t):"".concat(r,":[[").concat(a,",").concat(e,"]+").concat(t,"]")}function M(r,a,e){var t=r.concat(),n=b(t.slice(0,a),e);return R(E(n).concat(t,n))}function E(r){for(var a=[],e=r.length-1;e>=0;e--)a.push({base:r[e].base,amount:L(-r[e].amount)});return a}function U(r){var a=r.concat();if(a=R(a),0===a.length)return"";for(var e=0;e<=1;e++)for(var t=0;t<a.length-1;t++)w(a[t],a[t+1])&&ur[a[t].base].priority>ur[a[t+1].base].priority&&(a=S(a,t,t+1));var n=[];for(t=0;t<a.length;t++)a[t].amount<0?-1===a[t].amount?n[t]="".concat(a[t].base,"'"):n[t]="".concat(a[t].base+-a[t].amount,"'"):1===a[t].amount?n[t]=a[t].base:n[t]=a[t].base+a[t].amount;var u="".concat(n.join(" ")," ");for(var t in cr){var o=new RegExp("".concat(t," "),"gu");u=u.replace(o,"".concat(cr[t]," "))}return u=u.substring(0,u.length-1),u}function R(r){if(0===r.length)return[];for(var a=[],e=0;e<r.length;e++){var t={base:r[e].base,amount:L(r[e].amount)},n=a.length;if(0!==L(t.amount)){for(var u=!1,o=1;o<=3;o++)if(a.length>=o&&a[n-o].base===t.base){var c=!0;if(o>=2){for(var l=1;l<=o;l++)if(!(a[n-l].base in ur)){c=!1;break}for(l=2;l<=o;l++)if(!w(a[n-l],a[n-(l-1)])){c=!1;break}}if(c){var i={base:a[n-o].base,amount:L(a[n-o].amount+t.amount)};0===i.amount?a.splice(-o,1):a.splice(-o,1,i),u=!0;break}}u||(a[n]=t)}}return a}function w(r,a){return r.base in ur&&a.base in ur&&ur[r.base].class===ur[a.base].class}function S(r,a,e){return r[a]=r.splice(e,1,r[a])[0],r}function L(r){return W?r:(r%K+K-Q)%K+Q}var N=4294967295,y=4,k=!1,B=2.5,D=5,x=1,F=0,O=0,A=!1,C=!1,j=!1,P=!1,q=!1,z=!1,G={U:{class:1,priority:1},u:{class:1,priority:2},E:{class:1,priority:3},D:{class:1,priority:4},d:{class:1,priority:5},R:{class:2,priority:1},r:{class:2,priority:2},M:{class:2,priority:3},L:{class:2,priority:4},l:{class:2,priority:5},F:{class:3,priority:1},f:{class:3,priority:2},S:{class:3,priority:3},B:{class:3,priority:4},b:{class:3,priority:5}},H={Rw2:"r2","Rw'":"r'",Rw:"r",Lw2:"l2","Lw'":"l'",Lw:"l",Fw2:"f2","Fw'":"f'",Fw:"f",Bw2:"b2","Bw'":"b'",Bw:"b",Uw2:"u2","Uw'":"u'",Uw:"u",Dw2:"d2","Dw'":"d'",Dw:"d",r2:"R2 M2","r'":"R' M",r:"R M'",l2:"M2 L2","l'":"M' L'",l:"M L",f2:"F2 S2","f'":"F' S'",f:"F S",b2:"S2 B2","b'":"S B'",b:"S' B",u2:"U2 E2","u'":"U' E",u:"U E'",d2:"E2 D2","d'":"E' D'",d:"E D"},I={"R2 M2":"r2","R' M":"r'","R M'":"r","M2 L2":"l2","M' L'":"l'","M L":"l","F2 S2":"f2","F' S'":"f'","F S":"f","S2 B2":"b2","S B'":"b'","S' B":"b","U2 E2":"u2","U' E":"u'","U E'":"u","E2 D2":"d2","E' D'":"d'","E D":"d","M2 R2":"r2","M R'":"r'","M' R":"r","L2 M2":"l2","L' M'":"l'","L M":"l","S2 F2":"f2","S' F'":"f'","S F":"f","B2 S2":"b2","B' S":"b'","B S'":"b","E2 U2":"u2","E U'":"u'","E' U":"u","D2 E2":"d2","D' E'":"d'","D E":"d","R M2":"r M'","R' M2":"r' M","M2 R":"r M'","M2 R'":"r' M","U2 E":"U' u'","U2 E'":"U u","E U2":"U' u'","E' U2":"U u","U E2":"U' u2","U' E2":"U u2","E2 U":"U' u2","E2 U'":"U u2"},J=[],K=y,Q=Math.floor(y/2)+1-y,T=Math.floor(y/2),V=0,W=!1,X=k,Y=B,Z=D,$=x,_=A,rr=C,ar=j,er=P,tr=q,nr=z,ur=G,or=H,cr=I;return{search:s,expand:a,commutatorPost:p}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=commutator);